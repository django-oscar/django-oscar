{% extends 'oscar/dashboard/layout.html' %}
{% load currency_filters %}
{% load i18n %}

{% block body_class %}{{ block.super }} orders home{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <meta http-equiv="refresh" content="300">
{% endblock %}

{% block breadcrumbs %}
{% endblock %}

{% block headertext %}
{% trans "Dashboard" %}
{% endblock %}

{% block dashboard_content %}

<div class="table-header">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M3.98005 1.79497C5.04961 1.25 6.44974 1.25 9.25 1.25H14.75C17.5503 1.25 18.9504 1.25 20.02 1.79497C20.9608 2.27433 21.7257 3.03924 22.205 3.98005C22.75 5.04961 22.75 6.44974 22.75 9.25V14.75C22.75 17.5503 22.75 18.9504 22.205 20.02C21.7257 20.9608 20.9608 21.7257 20.02 22.205C18.9504 22.75 17.5503 22.75 14.75 22.75H9.25C6.44974 22.75 5.04961 22.75 3.98005 22.205C3.03924 21.7257 2.27433 20.9608 1.79497 20.02C1.25 18.9504 1.25 17.5503 1.25 14.75V9.25C1.25 6.44974 1.25 5.04961 1.79497 3.98005C2.27433 3.03924 3.03924 2.27433 3.98005 1.79497ZM17.5303 9.53033C17.8232 9.23744 17.8232 8.76256 17.5303 8.46967C17.2374 8.17678 16.7626 8.17678 16.4697 8.46967L13 11.9393L11.5303 10.4697C11.2374 10.1768 10.7626 10.1768 10.4697 10.4697L6.46967 14.4697C6.17678 14.7626 6.17678 15.2374 6.46967 15.5303C6.76256 15.8232 7.23744 15.8232 7.53033 15.5303L11 12.0607L12.4697 13.5303C12.6103 13.671 12.8011 13.75 13 13.75C13.1989 13.75 13.3897 13.671 13.5303 13.5303L17.5303 9.53033Z" fill="#0000FF"/>
        </svg>
         {% trans "Your Store Statistics" %}
</div>

<div class="content-block">
    <div class="row">
        <aside class="col-md-3 order-graph-details">
            <label><span><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M1.24992 0.0833435L0.833252 0.0833943C0.419038 0.083445 0.083293 0.419272 0.0833435 0.833486C0.0833941 1.2477 0.419221 1.58344 0.833435 1.58339L1.24999 1.58334H1.25007H1.2501C2.07224 1.58342 2.76924 2.18797 2.88551 3.00185L3.66881 8.48493L3.67298 8.51412C3.77381 9.21999 3.85548 9.79177 3.958 10.2539C4.06397 10.7316 4.20295 11.1469 4.44592 11.5255C4.83445 12.1309 5.38891 12.6117 6.04317 12.9108C6.45231 13.0977 6.88306 13.1766 7.37093 13.2139C7.84294 13.2501 8.42051 13.2501 9.13353 13.25H9.13358H9.16304L18.3333 13.25C18.7476 13.25 19.0833 12.9142 19.0833 12.5C19.0833 12.0858 18.7476 11.75 18.3333 11.75L16.8135 11.75C16.8693 11.6634 16.9208 11.5737 16.9677 11.4811C17.2917 10.8418 17.2917 10.0056 17.2917 8.33334C17.2917 6.66105 17.2917 5.8249 16.9677 5.18554C16.6793 4.61644 16.2169 4.1541 15.6478 3.86569C15.0085 3.54168 14.1723 3.54168 12.5 3.54168C10.8277 3.54168 9.99157 3.54168 9.35221 3.86569C8.7831 4.1541 8.32077 4.61644 8.03236 5.18554C7.70834 5.8249 7.70834 6.66105 7.70834 8.33334C7.70834 10.0056 7.70834 10.8418 8.03236 11.4811C8.07848 11.5722 8.12905 11.6604 8.18379 11.7457C7.91448 11.7416 7.68635 11.7337 7.48541 11.7183C7.08673 11.6878 6.85147 11.6309 6.66666 11.5465C6.2741 11.3671 5.94143 11.0785 5.70831 10.7153C5.59856 10.5443 5.509 10.3194 5.42241 9.92908C5.33378 9.52956 5.25973 9.01476 5.15373 8.2728L4.37043 2.78972C4.14859 1.23684 2.81867 0.0833818 1.25003 0.0833435L1.25001 0.833344L1.24992 0.0833435ZM7.50001 14.375C6.23436 14.375 5.20834 15.401 5.20834 16.6667C5.20834 17.9323 6.23436 18.9583 7.50001 18.9583C8.76566 18.9583 9.79168 17.9323 9.79168 16.6667C9.79168 15.401 8.76566 14.375 7.50001 14.375ZM15.8333 14.375C14.5677 14.375 13.5417 15.401 13.5417 16.6667C13.5417 17.9323 14.5677 18.9583 15.8333 18.9583C17.099 18.9583 18.125 17.9323 18.125 16.6667C18.125 15.401 17.099 14.375 15.8333 14.375Z" fill="#FF2E00"/>
                </svg>
                {{ total_orders_last_day }}</span>{% trans "Total Orders" %}</label>
            <label><span><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M7.50001 1.04166C5.31388 1.04166 3.54168 2.81386 3.54168 4.99999C3.54168 7.18612 5.31388 8.95832 7.50001 8.95832C9.68614 8.95832 11.4583 7.18612 11.4583 4.99999C11.4583 2.81386 9.68614 1.04166 7.50001 1.04166ZM0.208344 15.7917C0.208344 13.1683 2.33499 11.0417 4.95834 11.0417H10.0417C12.665 11.0417 14.7917 13.1683 14.7917 15.7917C14.7917 17.5406 13.3739 18.9583 11.625 18.9583H3.37501C1.62611 18.9583 0.208344 17.5406 0.208344 15.7917ZM17.4167 5.83332C17.4167 5.41911 17.0809 5.08332 16.6667 5.08332C16.2525 5.08332 15.9167 5.41911 15.9167 5.83332V7.58332H14.1667C13.7525 7.58332 13.4167 7.91911 13.4167 8.33332C13.4167 8.74754 13.7525 9.08332 14.1667 9.08332H15.9167V10.8333C15.9167 11.2475 16.2525 11.5833 16.6667 11.5833C17.0809 11.5833 17.4167 11.2475 17.4167 10.8333V9.08332H19.1667C19.5809 9.08332 19.9167 8.74754 19.9167 8.33332C19.9167 7.91911 19.5809 7.58332 19.1667 7.58332H17.4167V5.83332Z" fill="#00AB00"/>
                </svg>
                {{ total_customers_last_day }}</span>{% trans "New Customers" %}</label>
            <label><span><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M12.5 0.916656C12.0858 0.916656 11.75 1.25244 11.75 1.66666C11.75 2.08087 12.0858 2.41666 12.5 2.41666C13.9267 2.41666 15.0833 3.57325 15.0833 4.99999C15.0833 6.42673 13.9267 7.58332 12.5 7.58332C12.0858 7.58332 11.75 7.91911 11.75 8.33332C11.75 8.74754 12.0858 9.08332 12.5 9.08332C14.7552 9.08332 16.5833 7.25515 16.5833 4.99999C16.5833 2.74483 14.7552 0.916656 12.5 0.916656ZM14.1667 10.9167C13.7525 10.9167 13.4167 11.2524 13.4167 11.6667C13.4167 12.0809 13.7525 12.4167 14.1667 12.4167H15.1667C16.9616 12.4167 18.4167 13.8717 18.4167 15.6667C18.4167 16.7252 17.5586 17.5833 16.5 17.5833H14.1667C13.7525 17.5833 13.4167 17.9191 13.4167 18.3333C13.4167 18.7475 13.7525 19.0833 14.1667 19.0833H16.5C18.387 19.0833 19.9167 17.5536 19.9167 15.6667C19.9167 13.0433 17.79 10.9167 15.1667 10.9167H14.1667ZM6.66668 1.04166C4.48055 1.04166 2.70834 2.81386 2.70834 4.99999C2.70834 7.18612 4.48055 8.95832 6.66668 8.95832C8.8528 8.95832 10.625 7.18612 10.625 4.99999C10.625 2.81386 8.8528 1.04166 6.66668 1.04166ZM0.208344 15.7917C0.208344 13.1683 2.33499 11.0417 4.95835 11.0417H8.375C10.9984 11.0417 13.125 13.1683 13.125 15.7917C13.125 17.5406 11.7072 18.9583 9.95834 18.9583H3.37501C1.62611 18.9583 0.208344 17.5406 0.208344 15.7917Z" fill="#593D2B"/>
                </svg>
                {{ total_customers }}</span>{% trans "Total Customers" %}</label>
            <label><span><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10.4116 0.36146C10.2619 0.27167 10.1871 0.226775 10.1072 0.209234C10.0366 0.193718 9.9634 0.193718 9.89275 0.209234C9.81287 0.226775 9.73804 0.27167 9.58839 0.36146L2.40282 4.67281C2.0232 4.90058 1.83339 5.01446 1.76951 5.1614C1.71375 5.28963 1.71424 5.43535 1.77085 5.56321C1.83573 5.70972 2.0263 5.82233 2.40743 6.04754L4.82514 7.47619C4.97533 7.56494 5.05043 7.60932 5.1304 7.62632C5.20113 7.64137 5.27428 7.64089 5.34481 7.62492C5.42455 7.60687 5.49906 7.56152 5.64808 7.47081L12.7638 3.13951C13.1371 2.91228 13.3238 2.79866 13.3869 2.65255C13.4419 2.52502 13.4415 2.38032 13.3856 2.25314C13.3216 2.10744 13.1342 1.99501 12.7594 1.77016L10.4116 0.36146Z" fill="#FA8FEB"/>
                <path d="M7.59747 7.74758C7.22168 7.97633 7.03378 8.0907 6.97076 8.23744C6.91575 8.36551 6.9167 8.51073 6.97338 8.63807C7.03832 8.78398 7.22769 8.89588 7.60644 9.11969L9.59301 10.2936C9.7411 10.3811 9.81514 10.4248 9.89406 10.4419C9.96387 10.4571 10.0361 10.4571 10.1059 10.4419C10.1848 10.4248 10.2589 10.3811 10.407 10.2936L17.5926 6.04754C17.9737 5.82233 18.1643 5.70972 18.2291 5.56321C18.2857 5.43535 18.2862 5.28963 18.2305 5.1614C18.1666 5.01446 17.9768 4.90057 17.5972 4.67281L15.5198 3.42639C15.3691 3.33598 15.2938 3.29078 15.2134 3.27329C15.1423 3.25782 15.0687 3.25805 14.9977 3.27398C14.9174 3.29198 14.8423 3.33766 14.6922 3.42902L7.59747 7.74758Z" fill="#FA8FEB"/>
                <path d="M18.9583 8.09438C18.9583 7.63502 18.9583 7.40534 18.8619 7.27352C18.7779 7.15857 18.6488 7.08491 18.5071 7.07102C18.3445 7.0551 18.1468 7.17195 17.7513 7.40564L11.018 11.3844C10.8747 11.4691 10.8031 11.5114 10.7511 11.57C10.705 11.6219 10.6702 11.6829 10.649 11.7489C10.625 11.8236 10.625 11.9068 10.625 12.0732V18.1176C10.625 18.5801 10.625 18.8113 10.722 18.9434C10.8065 19.0586 10.9363 19.1321 11.0786 19.1453C11.2417 19.1605 11.44 19.0416 11.8366 18.8036L17.4047 15.4627C17.9712 15.1228 18.2545 14.9529 18.4603 14.7189C18.6424 14.5118 18.7796 14.2693 18.8635 14.0066C18.9583 13.7098 18.9583 13.3794 18.9583 12.7188V8.09438Z" fill="#FA8FEB"/>
                <path d="M8.16339 18.8036C8.55996 19.0416 8.75825 19.1605 8.9214 19.1453C9.06366 19.1321 9.19345 19.0586 9.27801 18.9434C9.37499 18.8113 9.37499 18.5801 9.37499 18.1176V12.0732C9.37499 11.9068 9.37499 11.8236 9.35098 11.7489C9.32974 11.6829 9.29498 11.6219 9.24892 11.57C9.19686 11.5114 9.12523 11.4691 8.98197 11.3844L2.24864 7.40564C1.85317 7.17195 1.65543 7.0551 1.49291 7.07102C1.35118 7.08491 1.2221 7.15857 1.13804 7.27352C1.04166 7.40534 1.04166 7.63502 1.04166 8.09438V12.7188C1.04166 13.3794 1.04166 13.7098 1.13645 14.0066C1.22033 14.2693 1.35763 14.5118 1.53971 14.7189C1.74547 14.9529 2.02874 15.1228 2.59527 15.4627L8.16339 18.8036Z" fill="#FA8FEB"/>
                </svg>
                {{ total_products }}</span>{% trans "Total Products" %}</label>
        </aside>
        <div class="col-md-9">
            <div id="order_graph">
                <div class="bar-caption"><h2>{% trans "Latest Orders <span>(last 24 hours)" %}</span></h2></div>
                <div class="bar-y-axis">
                    <ul>
                    {% for y_value in hourly_report_dict.y_range %}
                        <li><span>{{ y_value|currency }}</span></li>
                    {% endfor %}
                    </ul>
                </div>
                <dl class="bar-chart">
                    {% for item in hourly_report_dict.order_total_hourly %}
                        <dd class="bar-layer">
                            <em>{{ item.end_time|time }}</em>
                            <span style="height: {{ item.percentage }}%;" >
                                <p{% if item.percentage == 0 %} style="display: none;"{% endif %}>{{ item.total_incl_tax|currency }}</p>
                            </span>
                        </dd>
                    {% endfor %}
                </dl>
            </div>
        </div>
    </div>
</div>


<div class="row">
    <div class="col-md-4">
        <table class="table table-striped table-bordered table-hover dashboard-tables">
            <caption><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_128_864)">
                <path d="M1.66666 10C1.66666 14.1422 4.99999 18.3334 9.99999 18.3334C15 18.3334 18.3333 15 18.3333 10C18.3333 5.00002 15 1.66669 9.99999 1.66669C4.99999 1.66669 1.66666 5.83335 1.66666 5.83335M1.66666 5.83335V2.50002M1.66666 5.83335H4.58332M9.99999 6.66669V10L12.5 11.6667" stroke="#0000FF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </g>
                <defs>
                <clipPath id="clip0_128_864">
                <rect width="20" height="20" fill="white"/>
                </clipPath>
                </defs>
                </svg>
                 {% trans "Orders - Last 24 Hours" %}</caption>
            <tr>
                <th class="col-md-10">{% trans "Total orders" %}</th>
                <td class="col-md-2" >{{ total_orders_last_day }}</td>
            </tr>
            <tr>
                <th class="col-md-10">{% trans "Total lines" %}</th>
                <td class="col-md-2" >{{ total_lines_last_day }}</td>
            </tr>
            <tr>
                <th class="col-md-10">{% trans "Total revenue" %}</th>
                <td class="col-md-2" >{{ total_revenue_last_day|currency }}</td>
            </tr>
            <tr>
                <th class="col-md-10">{% trans "Average order costs" %}</th>
                <td class="col-md-2" >{{ average_order_costs|currency }}</td>
            </tr>
        </table>
    </div>

    <div class="col-md-4">
        <table class="table table-striped table-bordered table-hover dashboard-tables">
            <caption>
                <a href="{% url 'dashboard:order-list' %}" class="btn btn-secondary float-right">
                    <i class="fas fa-shopping-cart"></i> {% trans "Manage" %}
                </a>
                <i class="fas fa-shopping-cart"></i> {% trans "Orders - All Time" %}
            </caption>
            <tr>
                <th class="col-md-10">{% trans "Total orders" %}</th>
                <td class="col-md-2" >{{ total_orders }}</td>
            </tr>
            <tr>
                <th class="col-md-10">{% trans "Total lines" %}</th>
                <td class="col-md-2" >{{ total_lines }}</td>
            </tr>
            <tr>
                <th class="col-md-10">{% trans "Total revenue" %}</th>
                <td class="col-md-2" >{{ total_revenue|currency }}</td>
            </tr>
            <tr>
                <th class="col-md-10">{% trans "Total <em>open</em> baskets" %}</th>
                <td class="col-md-2" >{{ total_open_baskets }}</td>
            </tr>
        </table>
    </div>

    <div class="col-md-4">
        <table class="table table-striped table-bordered table-hover dashboard-tables">
            <caption><i class="fas fa-users"></i> {% trans "Customers" %}</caption>
            <tr>
                <th class="col-md-10">{% trans "Total customers" %}</th>
                <td class="col-md-2" >{{ total_customers }}</td>
            </tr>
            <tr>
                <th class="col-md-10">{% trans "New customers" %}</th>
                <td class="col-md-2" >{{ total_customers_last_day }}</td>
            </tr>
            <tr>
                <th class="col-md-10">{% trans "Total <em>open</em> baskets" %}</th>
                <td class="col-md-2" >{{ total_open_baskets_last_day }}</td>
            </tr>
        </table>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <table class="table table-striped table-bordered table-hover dashboard-tables">
            <caption>
                <div class="btn-toolbar float-right">
                    <div class="btn-group">
                        <a href="{% url 'dashboard:catalogue-product-list' %}" class="btn btn-secondary">
                            <i class="fas fa-sitemap"></i> {% trans "Manage" %}
                        </a>
                    </div>
                    <div class="btn-group ml-2">
                        <a href="{% url 'dashboard:stock-alert-list' %}" class="btn btn-secondary">
                            <i class="fas fa-sitemap"></i> {% trans "View Stock Alerts" %}
                        </a>
                    </div>
                </div>
                <i class="fas fa-sitemap"></i> {% trans "Catalogue and stock" %}
            </caption>
            <tr>
                <th class="col-md-10">{% trans "Total products" %}</th>
                    <td class="col-md-2" >{{ total_products }}</td>
            </tr>
            <tr>
                <th class="col-md-10">{% trans "<em>Open</em> stock alerts" %}</th>
                    <td class="col-md-2" >{{ total_open_stock_alerts }}</td>
            </tr>
            <tr>
                <th class="col-md-10">{% trans "<em>Closed</em> stock alerts" %}</th>
                    <td class="col-md-2" >{{ total_closed_stock_alerts }}</td>
            </tr>
        </table>
    </div>
    <div class="col-md-6">
        {% if user.is_staff %}
        <table class="table table-striped table-bordered table-hover dashboard-tables">
            <caption><i class="fas fa-gift"></i> {% trans "Offers, vouchers" %}</caption>
            {% for offer_map in offer_maps %}
            <tr>
                <th class="col-md-10">{% blocktrans with offer_type=offer_map.offer_type %}Active <em>{{ offer_type }}</em> Offers{% endblocktrans %}</th>
                <td class="col-md-2" >{{ offer_map.count }}</td>
            </tr>
            {% endfor %}
            <tr>
                <th class="col-md-10">{% trans "Active <em>Vouchers</em>" %}</th>
                <td class="col-md-2" >{{ total_vouchers }}</td>
            </tr>
        </table>
        {% endif %}
    </div>
</div>

{% endblock %}
