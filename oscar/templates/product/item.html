{% extends "layout.html" %}

{% load currency_filters %}

{% block header %}
<h2>{{item.get_title}}</h2>
{% endblock header %}


{% block content %}
<div class="images">
    {% for image in item.images.all %}
    <img src="{{ image.fullsize_url }}" title="{{ item.get_title }}" />
    <div class="caption">{{ image.caption }}</div>
    {% endfor %}
</div>


<table>
    <caption>Product details</caption>
    <tr>
        <th>UPC</th><td>{{item.upc}}</td>
    </tr>
    <tr>
        <th>Product class</th><td><a href="{{ item.item_class.get_absolute_url }}">{{item.item_class.name}}</a></td>
    </tr>
{% if item.stockrecord %}
    <tr>
        <th>Price (excl. tax)</th><td>{{item.stockrecord.price_incl_tax|currency}}</td>
    </tr>
    <tr>
        <th>Price (incl. tax)</th><td>{{item.stockrecord.price_excl_tax|currency}}</td>
    </tr>
    <tr>
        <th>Availability</th>
        <td>{{ item.stockrecord.availability }}</td>
    </tr>
{% endif %}
    <tr>
        <th>Product type</th>
        <td>
        {% if item.is_group %}Product group{% else %}{% if item.is_variant %}Variant{% else %}Stand-alone{% endif %}{% endif %}
        </td>
    </tr>
    {% for attribute in item.attributes.all %}
    <tr>
        <th>{{ attribute.type.name }}</th>
        <th>{{ attribute.value }}</th>
    </tr>
    {% endfor %}
     <tr>
        <td><a href="{{ item.get_absolute_url }}add-review/"> Add a review</a></td>
    </tr>
</table>

{% if item.stockrecord %}
<form action="{% url oscar-basket %}" method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <input type="submit" value="Add to basket" />
</form>
{% endif %}


{% block product_review %}

{% if reviews %}
	{% if avg_score %}
		<h3> Product Reviews </h3>
		<h4> Average score: {{ avg_score|floatformat:1  }} / 5.0 </h4>
	{% endif %}
	{% for review in reviews|slice:":5" %}		
		<h4> {{ forloop.counter}}. {{ review.title }} </h4>
		<p> Score: {{ review.score|floatformat:1 }} / 5.0</p>
		<p> Comments: {{ review.body }}</p>
	{% if user.is_authenticated %}
		{% if vote %}
		<h4> You have added {{ vote }} for this product</h4>
		{% endif %}	
		<h4> Was this review helpful to you? </h4>
		<form method="get" action="{{ review.get_vote_url }}">                
                <input type="hidden" name="action" id="action_id" value="voteup"/>
                <input type="submit" value="Yes" /> 
            </form>
		<form method="get" action="{% url oscar-vote-review item.item_class.slug,item.slug,item.id|stringformat:"s",review.id|stringformat:"s" %}">                
                <input type="hidden" name="action" id="action_id" value="votedown"/>
                <input type="submit" value="No" /> 
            </form>
	{% endif %}			
	{% endfor %}
{% endif %}
{% endblock product_review %}

{% endblock content %}


